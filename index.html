<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HaposLight POS</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Modern Single-Screen POS Layout */
    .screen {
      background: #f8fafc;
      display: grid;
      grid-template-rows: auto 1fr;
      height:100%;
      position:relative;
    }

    /* Header */
    header {
      position:sticky;
      top:0;
      z-index:10;
      display:flex;
      align-items:center;
      gap:12px;
      padding:12px 16px;
      background:#1e293b;
      color:#fff;
      box-shadow:0 2px 8px rgba(0,0,0,.2);
      border-bottom:3px solid #0ea5e9;
    }
    header h1{ font-size:18px; margin:0; letter-spacing:.5px; font-weight:700; }

    .phone.tablet header{ padding:18px 24px; gap:16px; }
    .phone.tablet header h1{ font-size:26px; }

    /* Main Content Area */
    .main-content{
      display:grid;
      grid-template-columns: 1fr 230px;
      gap:0;
      overflow:hidden;
      height:100%;
    }

    .phone.tablet .main-content{
      grid-template-columns: 1fr 380px;
    }

    /* Left Side: Products */
    .products-area{
      display:grid;
      grid-template-rows:auto 1fr;
      background:#fff;
      overflow:hidden;
      border-right:3px solid #e2e8f0;
    }

    .categories-bar{
      display:flex;
      gap:6px;
      padding:12px;
      background:#f1f5f9;
      overflow-x:auto;
      border-bottom:2px solid #cbd5e1;
      flex-wrap:wrap;
    }
    .cat{
      padding:8px 16px;
      border-radius:8px;
      background:#fff;
      border:2px solid #cbd5e1;
      cursor:pointer;
      white-space:nowrap;
      font-size:12px;
      font-weight:600;
      color:#475569;
      transition:all .2s ease;
      flex-shrink:0;
    }
    .cat:hover{ background:#f8fafc; border-color:#94a3b8; }
    .cat.active{ background:#0ea5e9; color:#fff; border-color:#0ea5e9; box-shadow:0 2px 8px rgba(14,165,233,.3); }

    .phone.tablet .categories-bar{ padding:16px; gap:10px; }
    .phone.tablet .cat{ padding:12px 24px; font-size:16px; border-radius:12px; }

    .products-grid{
      padding:12px;
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap:10px;
      height:100%;
      overflow-y:auto;
      align-content:start;
      background:#f8fafc;
    }

    .phone.tablet .products-grid{
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap:14px;
      padding:16px;
    }

    .product-item{
      background:linear-gradient(135deg, #10b981, #059669);
      border:none;
      border-radius:12px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:6px;
      cursor:pointer;
      transition:all .2s ease;
      align-items:center;
      justify-content:center;
      min-height:90px;
      box-shadow:0 2px 8px rgba(16,185,129,.3);
    }
    .product-item:hover{
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(16,185,129,.4);
    }
    .product-item:active{ transform:scale(0.97); }
    .product-item .name{ font-size:13px; font-weight:700; color:#fff; text-align:center; line-height:1.2; }
    .product-item .price{ font-size:12px; color:#fff; font-weight:600; text-align:center; background:rgba(0,0,0,.2); padding:4px 10px; border-radius:6px; }

    .phone.tablet .product-item{ padding:16px; gap:8px; min-height:130px; border-radius:16px; }
    .phone.tablet .product-item .name{ font-size:17px; }
    .phone.tablet .product-item .price{ font-size:15px; padding:6px 14px; }

    /* Right Side: Cart & Checkout */
    .cart-area{
      background:#fff;
      display:grid;
      grid-template-rows:auto 1fr auto auto auto auto;
      overflow:hidden;
      box-shadow:-3px 0 12px rgba(0,0,0,.08);
    }

    .cart-header{
      padding:8px 10px;
      background:#1e293b;
      color:#fff;
      font-size:11px;
      font-weight:700;
      border-bottom:2px solid #334155;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }

    .phone.tablet .cart-header{ padding:16px 20px; font-size:18px; }

    .cart-items{
      overflow-y:auto;
      padding:8px;
      background:#f8fafc;
    }

    .phone.tablet .cart-items{ padding:16px; }

    .cart-item{
      display:grid;
      grid-template-columns:1fr auto;
      align-items:center;
      gap:4px;
      padding:6px 8px;
      background:#fff;
      border-radius:6px;
      margin-bottom:6px;
      border:1px solid #e2e8f0;
      box-shadow:0 1px 3px rgba(0,0,0,.05);
    }
    .cart-item-name{ font-size:10px; font-weight:600; color:#1e293b; line-height:1.2; }
    .cart-item-price{ font-size:9px; color:#64748b; }
    .cart-item-qty{
      display:flex;
      align-items:center;
      gap:3px;
      background:#f1f5f9;
      padding:2px;
      border-radius:4px;
    }
    .qty-btn{
      width:20px;
      height:20px;
      border-radius:3px;
      border:none;
      background:#0ea5e9;
      color:#fff;
      cursor:pointer;
      font-size:12px;
      font-weight:700;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .qty-btn:hover{ background:#0284c7; }
    .qty-value{ font-size:10px; font-weight:700; color:#1e293b; min-width:16px; text-align:center; }
    .cart-item-total{ font-size:11px; font-weight:700; color:#059669; }

    .phone.tablet .cart-item{ padding:14px 16px; gap:12px; margin-bottom:12px; border-radius:12px; grid-template-columns:1fr auto auto; }
    .phone.tablet .cart-item-name{ font-size:15px; }
    .phone.tablet .cart-item-price{ font-size:13px; }
    .phone.tablet .qty-btn{ width:32px; height:32px; font-size:16px; }
    .phone.tablet .qty-value{ font-size:15px; min-width:28px; }
    .phone.tablet .cart-item-total{ font-size:16px; }

    .empty-cart{
      text-align:center;
      padding:20px 10px;
      color:#94a3b8;
      font-size:10px;
    }

    .phone.tablet .empty-cart{ padding:60px 20px; font-size:16px; }

    /* Order Type Selection */
    .order-type-section{
      padding:8px 10px;
      background:#f1f5f9;
      border-top:2px solid #e2e8f0;
    }
    .section-label{
      font-size:9px;
      font-weight:700;
      color:#475569;
      margin-bottom:5px;
      text-transform:uppercase;
      letter-spacing:.3px;
    }
    .order-type-buttons{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:5px;
    }
    .order-type-btn{
      padding:7px;
      border-radius:6px;
      border:2px solid #cbd5e1;
      background:#fff;
      color:#475569;
      font-size:10px;
      font-weight:700;
      cursor:pointer;
      transition:all .2s ease;
    }
    .order-type-btn:hover{ border-color:#94a3b8; }
    .order-type-btn.selected{
      background:#8b5cf6;
      color:#fff;
      border-color:#8b5cf6;
      box-shadow:0 2px 8px rgba(139,92,246,.3);
    }

    .phone.tablet .order-type-section{ padding:16px 20px; }
    .phone.tablet .section-label{ font-size:14px; margin-bottom:12px; }
    .phone.tablet .order-type-buttons{ gap:12px; }
    .phone.tablet .order-type-btn{ padding:14px; font-size:15px; border-radius:10px; }

    /* Payment Method Selection */
    .payment-section{
      padding:8px 10px;
      background:#f8fafc;
      border-top:2px solid #e2e8f0;
    }
    .payment-buttons{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:5px;
    }
    .payment-btn{
      padding:7px;
      border-radius:6px;
      border:2px solid #cbd5e1;
      background:#fff;
      color:#475569;
      font-size:10px;
      font-weight:700;
      cursor:pointer;
      transition:all .2s ease;
    }
    .payment-btn:hover{ border-color:#94a3b8; }
    .payment-btn.selected{
      background:#f59e0b;
      color:#fff;
      border-color:#f59e0b;
      box-shadow:0 2px 8px rgba(245,158,11,.3);
    }

    .phone.tablet .payment-section{ padding:16px 20px; }
    .phone.tablet .payment-buttons{ gap:12px; }
    .phone.tablet .payment-btn{ padding:14px; font-size:15px; border-radius:10px; }

    /* Total & Checkout */
    .checkout-section{
      padding:8px 10px;
      background:#1e293b;
      border-top:3px solid #0ea5e9;
    }
    .total-display{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
      color:#fff;
    }
    .total-label{ font-size:10px; font-weight:600; }
    .total-amount{ font-size:18px; font-weight:900; color:#0ea5e9; }

    .checkout-btn{
      width:100%;
      padding:10px;
      border-radius:8px;
      border:none;
      background:linear-gradient(135deg, #10b981, #059669);
      color:#fff;
      font-size:11px;
      font-weight:900;
      cursor:pointer;
      transition:all .2s ease;
      box-shadow:0 4px 12px rgba(16,185,129,.4);
      text-transform:uppercase;
      letter-spacing:.5px;
    }
    .checkout-btn:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 16px rgba(16,185,129,.5);
    }
    .checkout-btn:active{ transform:scale(0.98); }
    .checkout-btn:disabled{
      background:#64748b;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    .phone.tablet .checkout-section{ padding:16px 20px; }
    .phone.tablet .total-label{ font-size:16px; }
    .phone.tablet .total-amount{ font-size:32px; }
    .phone.tablet .checkout-btn{ padding:18px; font-size:18px; border-radius:12px; }

    /* Settings Button */
    .settings-btn{
      padding:6px 10px;
      border-radius:6px;
      border:1px solid #475569;
      background:#334155;
      color:#fff;
      font-size:11px;
      font-weight:600;
      cursor:pointer;
      transition:all .2s ease;
      margin-left:auto;
    }
    .settings-btn:hover{ background:#475569; }

    .phone.tablet .settings-btn{ padding:10px 18px; font-size:14px; border-radius:8px; }

    /* Settings Popup */
    #settingsBackdrop{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,.5);
      z-index:15;
      display:none;
    }
    #settingsBackdrop.show{ display:block; }

    #settingsPopup{
      position:absolute;
      top:50px;
      right:10px;
      background:#fff;
      border-radius:12px;
      box-shadow:0 10px 40px rgba(0,0,0,.3);
      width:220px;
      z-index:16;
      display:none;
      overflow:hidden;
    }
    #settingsPopup.show{ display:block; }

    .phone.tablet #settingsPopup{
      width:320px;
      top:70px;
      right:20px;
    }

    .settings-header{
      padding:12px 16px;
      background:#1e293b;
      color:#fff;
      font-size:13px;
      font-weight:700;
      border-bottom:2px solid #0ea5e9;
    }

    .phone.tablet .settings-header{ padding:16px 20px; font-size:16px; }

    .settings-row{
      padding:12px 16px;
      border-bottom:1px solid #e2e8f0;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .settings-row:last-child{ border-bottom:none; }

    .settings-label{
      font-size:11px;
      font-weight:700;
      color:#475569;
      text-transform:uppercase;
      letter-spacing:.3px;
    }

    .settings-row select{
      padding:8px 12px;
      border-radius:8px;
      border:2px solid #cbd5e1;
      font-size:12px;
      background:#f8fafc;
      cursor:pointer;
      width:100%;
    }

    .settings-row button{
      padding:10px;
      border-radius:8px;
      border:none;
      background:#0ea5e9;
      color:#fff;
      font-size:12px;
      font-weight:700;
      cursor:pointer;
      transition:all .2s ease;
      width:100%;
    }
    .settings-row button:hover{ background:#0284c7; }

    .phone.tablet .settings-row{ padding:16px 20px; gap:12px; }
    .phone.tablet .settings-label{ font-size:13px; }
    .phone.tablet .settings-row select{ padding:10px 16px; font-size:14px; }
    .phone.tablet .settings-row button{ padding:12px; font-size:14px; }

    /* Sales Report Modal */
    #salesReportBackdrop{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,.6);
      z-index:20;
      display:none;
      backdrop-filter:blur(4px);
    }
    #salesReportBackdrop.show{ display:block; }

    #salesReportModal{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      background:#fff;
      border-radius:16px;
      box-shadow:0 20px 60px rgba(0,0,0,.4);
      width:90%;
      max-width:700px;
      max-height:80vh;
      z-index:21;
      display:none;
      overflow:hidden;
    }
    #salesReportModal.show{ display:block; }

    .report-header{
      padding:16px 20px;
      background:#1e293b;
      color:#fff;
      font-size:16px;
      font-weight:700;
      border-bottom:3px solid #0ea5e9;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .close-btn{
      background:#334155;
      border:none;
      color:#fff;
      width:32px;
      height:32px;
      border-radius:8px;
      cursor:pointer;
      font-size:20px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .close-btn:hover{ background:#475569; }

    .phone.tablet .report-header{ padding:20px 24px; font-size:20px; }
    .phone.tablet .close-btn{ width:40px; height:40px; font-size:24px; }

    .report-filters{
      padding:16px;
      background:#f8fafc;
      border-bottom:2px solid #e2e8f0;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
    }
    .report-filters select{
      padding:8px 12px;
      border-radius:8px;
      border:2px solid #cbd5e1;
      font-size:12px;
      background:#fff;
      cursor:pointer;
    }
    .report-filters button{
      padding:8px 16px;
      border-radius:8px;
      border:none;
      background:#0ea5e9;
      color:#fff;
      font-size:12px;
      font-weight:700;
      cursor:pointer;
      margin-left:auto;
    }
    .report-filters button:hover{ background:#0284c7; }

    .phone.tablet .report-filters{ padding:20px; gap:16px; }
    .phone.tablet .report-filters select{ padding:10px 16px; font-size:14px; }
    .phone.tablet .report-filters button{ padding:10px 20px; font-size:14px; }

    .report-content{
      padding:16px;
      max-height:50vh;
      overflow-y:auto;
      background:#fff;
    }

    .phone.tablet .report-content{ padding:20px; }

    .report-summary{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
      margin-bottom:20px;
    }
    .summary-card{
      background:linear-gradient(135deg,#f8fafc,#fff);
      border:2px solid #e2e8f0;
      border-radius:12px;
      padding:16px;
      text-align:center;
    }
    .summary-card .label{ font-size:11px; color:#64748b; margin-bottom:6px; font-weight:600; text-transform:uppercase; }
    .summary-card .value{ font-size:20px; font-weight:900; color:#1e293b; }

    .phone.tablet .report-summary{ gap:16px; margin-bottom:24px; }
    .phone.tablet .summary-card{ padding:20px; border-radius:16px; }
    .phone.tablet .summary-card .label{ font-size:13px; margin-bottom:8px; }
    .phone.tablet .summary-card .value{ font-size:26px; }

    .sales-table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
    }
    .sales-table th{
      background:#f1f5f9;
      padding:10px 8px;
      text-align:left;
      font-size:11px;
      font-weight:700;
      color:#475569;
      border-bottom:2px solid #cbd5e1;
      text-transform:uppercase;
      letter-spacing:.3px;
    }
    .sales-table td{
      padding:10px 8px;
      border-bottom:1px solid #e2e8f0;
      font-size:11px;
      color:#1e293b;
    }
    .sales-table tr:hover{ background:#f8fafc; }

    .phone.tablet .sales-table{ font-size:13px; }
    .phone.tablet .sales-table th{ padding:12px 10px; font-size:13px; }
    .phone.tablet .sales-table td{ padding:12px 10px; font-size:13px; }

    .refund-btn{
      padding:6px 12px;
      border-radius:6px;
      border:none;
      background:#ef4444;
      color:#fff;
      font-size:10px;
      font-weight:700;
      cursor:pointer;
      transition:all .2s ease;
    }
    .refund-btn:hover{ background:#dc2626; }
    .refund-btn:disabled{ background:#94a3b8; cursor:not-allowed; }

    .phone.tablet .refund-btn{ padding:8px 16px; font-size:12px; border-radius:8px; }

    .report-footer{
      padding:16px;
      background:#f8fafc;
      border-top:2px solid #e2e8f0;
      display:flex;
      gap:12px;
    }
    .report-footer button{
      flex:1;
      padding:12px;
      border-radius:10px;
      border:none;
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      transition:all .2s ease;
    }
    .export-btn{ background:#0ea5e9; color:#fff; }
    .export-btn:hover{ background:#0284c7; }

    .phone.tablet .report-footer{ padding:20px; gap:16px; }
    .phone.tablet .report-footer button{ padding:16px; font-size:16px; }
  </style>
</head>
<body class="body">
  <div class="device-toggle">
    <button id="phoneBtn" class="active">Phone</button>
    <button id="tabletBtn">Tablet</button>
  </div>
  <div class="viewport">
    <div class="phone" id="deviceFrame">
      <div class="notch"></div>
      <div class="screen" role="application" aria-label="Point of Sale">
        <header>
          <h1>HaposLight POS</h1>
          <button class="settings-btn" id="settingsBtn">Settings</button>
        </header>

        <div class="main-content">
          <!-- Left: Products -->
          <div class="products-area">
            <div class="categories-bar" id="categories"></div>
            <div class="products-grid" id="productsGrid"></div>
          </div>

          <!-- Right: Cart & Checkout -->
          <div class="cart-area">
            <div class="cart-header">
              <span>Current Order</span>
              <span id="itemCount">0 items</span>
            </div>

            <div class="cart-items" id="cartItems">
              <div class="empty-cart">Cart is empty<br>Add products to start</div>
            </div>

            <div class="order-type-section">
              <div class="section-label">Order Type</div>
              <div class="order-type-buttons">
                <button class="order-type-btn" id="takeAwayBtn" data-type="Take Away">Take Away</button>
                <button class="order-type-btn" id="eatInBtn" data-type="Eat In">Eat In</button>
              </div>
            </div>

            <div class="payment-section">
              <div class="section-label">Payment Method</div>
              <div class="payment-buttons">
                <button class="payment-btn" id="cashBtn" data-method="Cash">Cash</button>
                <button class="payment-btn" id="cardBtn" data-method="Card">Card</button>
              </div>
            </div>

            <div class="checkout-section">
              <div class="total-display">
                <span class="total-label">Total</span>
                <span class="total-amount" id="totalAmount">€0.00</span>
              </div>
              <button class="checkout-btn" id="checkoutBtn" disabled>Complete Order</button>
            </div>
          </div>
        </div>

        <!-- Settings Popup -->
        <div id="settingsBackdrop"></div>
        <div id="settingsPopup">
          <div class="settings-header">Settings</div>
          <div class="settings-row">
            <div class="settings-label">Cashier</div>
            <select id="cashierSel">
              <option>Alex</option>
              <option>Sam</option>
              <option>Taylor</option>
            </select>
          </div>
          <div class="settings-row">
            <div class="settings-label">Reports</div>
            <button id="openSalesReportBtn">View Sales Report</button>
          </div>
        </div>

        <!-- Sales Report Modal -->
        <div id="salesReportBackdrop"></div>
        <div id="salesReportModal">
          <div class="report-header">
            <span>Sales Report</span>
            <button class="close-btn" id="closeReportBtn">×</button>
          </div>
          <div class="report-filters">
            <select id="reportPeriod">
              <option value="today">Today</option>
              <option value="yesterday">Yesterday</option>
              <option value="week">This Week</option>
              <option value="month">This Month</option>
              <option value="all">All Time</option>
            </select>
            <select id="reportPayment">
              <option value="all">All Payments</option>
              <option value="Cash">Cash</option>
              <option value="Card">Card</option>
            </select>
            <button id="refreshReportBtn">Refresh</button>
          </div>
          <div class="report-content" id="reportContent"></div>
          <div class="report-footer">
            <button class="export-btn" id="exportBtn">Export CSV</button>
          </div>
        </div>
      </div>
      <div class="home-indicator"></div>
    </div>
  </div>

  <script>
    const data = {
      categories: ["Coffee", "Bakery", "Snacks", "Drinks", "Merch"],
      products: {
        Coffee: [
          {name:"Espresso", price:2.50},
          {name:"Americano", price:3.00},
          {name:"Latte", price:3.50},
          {name:"Cappuccino", price:3.50},
          {name:"Mocha", price:3.80},
          {name:"Flat White", price:3.60},
          {name:"Macchiato", price:2.80},
          {name:"Iced Latte", price:3.70},
          {name:"Cold Brew", price:3.90},
          {name:"Affogato", price:4.20}
        ],
        Bakery: [
          {name:"Croissant", price:2.20},
          {name:"Chocolate Muffin", price:2.50},
          {name:"Bagel", price:1.80},
          {name:"Brownie", price:2.30},
          {name:"Cookie", price:1.50},
          {name:"Banana Bread", price:2.60},
          {name:"Apple Pie", price:3.00},
          {name:"Donut", price:1.90}
        ],
        Snacks: [
          {name:"Chips", price:1.20},
          {name:"Granola Bar", price:1.50},
          {name:"Nuts Mix", price:1.80},
          {name:"Pretzel", price:1.30},
          {name:"Popcorn", price:1.40},
          {name:"Protein Bar", price:2.10}
        ],
        Drinks: [
          {name:"Water", price:1.00},
          {name:"Sparkling Water", price:1.50},
          {name:"Orange Juice", price:2.00},
          {name:"Iced Tea", price:1.70},
          {name:"Cola", price:1.60},
          {name:"Milkshake", price:2.80}
        ],
        Merch: [
          {name:"Mug", price:8.00},
          {name:"T-Shirt", price:15.00},
          {name:"Beans 250g", price:6.50},
          {name:"Thermos", price:18.00},
          {name:"Sticker Pack", price:3.00}
        ]
      }
    };

    const state = {
      category: data.categories[0],
      cart: [],
      orderType: null,
      paymentMethod: null
    };

    const $ = (sel) => document.querySelector(sel);
    const fmt = (n) => n.toFixed(2);

    // Sales History Management
    function getSalesHistory(){
      const history = localStorage.getItem('salesHistory');
      return history ? JSON.parse(history) : [];
    }

    function saveSale(sale){
      const history = getSalesHistory();
      history.push(sale);
      localStorage.setItem('salesHistory', JSON.stringify(history));
    }

    function refundSale(saleId){
      const history = getSalesHistory();
      const sale = history.find(s => s.id === saleId);
      if(sale && !sale.refunded){
        sale.refunded = true;
        sale.refundedAt = new Date().toISOString();
        localStorage.setItem('salesHistory', JSON.stringify(history));
        generateSalesReport();
      }
    }

    // Render Categories
    function renderCategories(){
      const container = $('#categories');
      container.innerHTML = '';
      data.categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'cat' + (cat === state.category ? ' active' : '');
        btn.textContent = cat;
        btn.onclick = () => {
          state.category = cat;
          renderCategories();
          renderProducts();
        };
        container.appendChild(btn);
      });
    }

    // Render Products
    function renderProducts(){
      const grid = $('#productsGrid');
      grid.innerHTML = '';
      data.products[state.category].forEach(product => {
        const item = document.createElement('button');
        item.className = 'product-item';
        item.innerHTML = `
          <div class="name">${product.name}</div>
          <div class="price">€${fmt(product.price)}</div>
        `;
        item.onclick = () => addToCart(product);
        grid.appendChild(item);
      });
    }

    // Add to Cart
    function addToCart(product){
      const found = state.cart.find(i => i.name === product.name);
      if(found){
        found.qty++;
      } else {
        state.cart.push({name: product.name, price: product.price, qty: 1});
      }
      renderCart();
      updateTotal();
      updateCheckoutButton();
    }

    // Render Cart
    function renderCart(){
      const container = $('#cartItems');
      if(state.cart.length === 0){
        container.innerHTML = '<div class="empty-cart">Cart is empty<br>Add products to start</div>';
        return;
      }

      container.innerHTML = '';
      state.cart.forEach(item => {
        const el = document.createElement('div');
        el.className = 'cart-item';
        el.innerHTML = `
          <div>
            <div class="cart-item-name">${item.name}</div>
            <div class="cart-item-price">€${fmt(item.price)} × ${item.qty} = €${fmt(item.qty * item.price)}</div>
          </div>
          <div class="cart-item-qty">
            <button class="qty-btn" onclick="decreaseQty('${item.name}')">−</button>
            <span class="qty-value">${item.qty}</span>
            <button class="qty-btn" onclick="increaseQty('${item.name}')">+</button>
          </div>
        `;
        container.appendChild(el);
      });
    }

    window.increaseQty = (name) => {
      const item = state.cart.find(i => i.name === name);
      if(item){
        item.qty++;
        renderCart();
        updateTotal();
      }
    };

    window.decreaseQty = (name) => {
      const item = state.cart.find(i => i.name === name);
      if(item){
        item.qty--;
        if(item.qty <= 0){
          state.cart = state.cart.filter(i => i.name !== name);
        }
        renderCart();
        updateTotal();
        updateCheckoutButton();
      }
    };

    // Update Total
    function updateTotal(){
      const total = state.cart.reduce((sum, item) => sum + (item.qty * item.price), 0);
      const count = state.cart.reduce((sum, item) => sum + item.qty, 0);
      $('#totalAmount').textContent = '€' + fmt(total);
      $('#itemCount').textContent = count + ' item' + (count !== 1 ? 's' : '');
    }

    // Update Checkout Button
    function updateCheckoutButton(){
      const btn = $('#checkoutBtn');
      const canCheckout = state.cart.length > 0 && state.orderType && state.paymentMethod;
      btn.disabled = !canCheckout;
    }

    // Order Type Selection
    $('#takeAwayBtn').onclick = () => {
      state.orderType = 'Take Away';
      $('#takeAwayBtn').classList.add('selected');
      $('#eatInBtn').classList.remove('selected');
      updateCheckoutButton();
    };

    $('#eatInBtn').onclick = () => {
      state.orderType = 'Eat In';
      $('#eatInBtn').classList.add('selected');
      $('#takeAwayBtn').classList.remove('selected');
      updateCheckoutButton();
    };

    // Payment Method Selection
    $('#cashBtn').onclick = () => {
      state.paymentMethod = 'Cash';
      $('#cashBtn').classList.add('selected');
      $('#cardBtn').classList.remove('selected');
      updateCheckoutButton();
    };

    $('#cardBtn').onclick = () => {
      state.paymentMethod = 'Card';
      $('#cardBtn').classList.add('selected');
      $('#cashBtn').classList.remove('selected');
      updateCheckoutButton();
    };

    // Checkout
    $('#checkoutBtn').onclick = () => {
      if(state.cart.length === 0 || !state.orderType || !state.paymentMethod) return;

      const sale = {
        id: Date.now() + '-' + Math.random().toString(36).substr(2, 9),
        items: [...state.cart],
        total: state.cart.reduce((sum, item) => sum + (item.qty * item.price), 0),
        orderType: state.orderType,
        paymentMethod: state.paymentMethod,
        cashier: $('#cashierSel').value,
        timestamp: new Date().toISOString(),
        refunded: false
      };

      saveSale(sale);

      // Reset
      state.cart = [];
      state.orderType = null;
      state.paymentMethod = null;
      $('#takeAwayBtn').classList.remove('selected');
      $('#eatInBtn').classList.remove('selected');
      $('#cashBtn').classList.remove('selected');
      $('#cardBtn').classList.remove('selected');

      renderCart();
      updateTotal();
      updateCheckoutButton();

      alert('Order completed successfully!');
    };

    // Device Toggle
    $('#phoneBtn').onclick = () => {
      $('#deviceFrame').classList.remove('tablet');
      $('#phoneBtn').classList.add('active');
      $('#tabletBtn').classList.remove('active');
    };

    $('#tabletBtn').onclick = () => {
      $('#deviceFrame').classList.add('tablet');
      $('#tabletBtn').classList.add('active');
      $('#phoneBtn').classList.remove('active');
    };

    // Settings Popup
    $('#settingsBtn').onclick = () => {
      $('#settingsBackdrop').classList.add('show');
      $('#settingsPopup').classList.add('show');
    };

    $('#settingsBackdrop').onclick = () => {
      $('#settingsBackdrop').classList.remove('show');
      $('#settingsPopup').classList.remove('show');
    };

    // Sales Report
    $('#openSalesReportBtn').onclick = () => {
      // Close settings popup first
      $('#settingsBackdrop').classList.remove('show');
      $('#settingsPopup').classList.remove('show');

      // Open sales report
      $('#salesReportBackdrop').classList.add('show');
      $('#salesReportModal').classList.add('show');
      generateSalesReport();
    };

    $('#closeReportBtn').onclick = () => {
      $('#salesReportBackdrop').classList.remove('show');
      $('#salesReportModal').classList.remove('show');
    };

    $('#salesReportBackdrop').onclick = () => {
      $('#salesReportBackdrop').classList.remove('show');
      $('#salesReportModal').classList.remove('show');
    };

    $('#refreshReportBtn').onclick = () => {
      generateSalesReport();
    };

    $('#reportPeriod').onchange = () => {
      generateSalesReport();
    };

    $('#reportPayment').onchange = () => {
      generateSalesReport();
    };

    function filterSalesByPeriod(sales, period){
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

      return sales.filter(sale => {
        const saleDate = new Date(sale.timestamp);
        const saleDateOnly = new Date(saleDate.getFullYear(), saleDate.getMonth(), saleDate.getDate());

        switch(period){
          case 'today':
            return saleDateOnly.getTime() === today.getTime();
          case 'yesterday':
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            return saleDateOnly.getTime() === yesterday.getTime();
          case 'week':
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);
            return saleDate >= weekAgo;
          case 'month':
            const monthAgo = new Date(today);
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            return saleDate >= monthAgo;
          case 'all':
          default:
            return true;
        }
      });
    }

    function generateSalesReport(){
      const period = $('#reportPeriod').value;
      const paymentFilter = $('#reportPayment').value;

      let sales = getSalesHistory();
      sales = filterSalesByPeriod(sales, period);

      if(paymentFilter !== 'all'){
        sales = sales.filter(s => s.paymentMethod === paymentFilter);
      }

      const totalSales = sales.filter(s => !s.refunded).length;
      const totalRefunds = sales.filter(s => s.refunded).length;
      const totalRevenue = sales.filter(s => !s.refunded).reduce((sum, sale) => sum + sale.total, 0);
      const avgSale = totalSales > 0 ? totalRevenue / totalSales : 0;

      let html = `
        <div class="report-summary">
          <div class="summary-card">
            <div class="label">Total Sales</div>
            <div class="value">${totalSales}</div>
          </div>
          <div class="summary-card">
            <div class="label">Total Revenue</div>
            <div class="value">€${fmt(totalRevenue)}</div>
          </div>
          <div class="summary-card">
            <div class="label">Refunds</div>
            <div class="value">${totalRefunds}</div>
          </div>
        </div>
      `;

      if(sales.length > 0){
        html += `
          <table class="sales-table">
            <thead>
              <tr>
                <th>Date/Time</th>
                <th>Cashier</th>
                <th>Type</th>
                <th>Payment</th>
                <th>Total</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
        `;

        sales.reverse().forEach(sale => {
          const date = new Date(sale.timestamp);
          const dateStr = date.toLocaleDateString();
          const timeStr = date.toLocaleTimeString();

          html += `
            <tr style="${sale.refunded ? 'opacity:0.5;text-decoration:line-through;' : ''}">
              <td>${dateStr} ${timeStr}</td>
              <td>${sale.cashier}</td>
              <td>${sale.orderType}</td>
              <td>${sale.paymentMethod}</td>
              <td><strong>€${fmt(sale.total)}</strong></td>
              <td>
                <button class="refund-btn" onclick="refundSale('${sale.id}')" ${sale.refunded ? 'disabled' : ''}>
                  ${sale.refunded ? 'Refunded' : 'Refund'}
                </button>
              </td>
            </tr>
          `;
        });

        html += `
            </tbody>
          </table>
        `;
      } else {
        html += `<div style="text-align:center; padding:40px; color:#94a3b8;">No sales found for the selected period.</div>`;
      }

      $('#reportContent').innerHTML = html;
    }

    window.refundSale = (saleId) => {
      if(confirm('Are you sure you want to refund this sale?')){
        refundSale(saleId);
      }
    };

    $('#exportBtn').onclick = () => {
      const period = $('#reportPeriod').value;
      const paymentFilter = $('#reportPayment').value;

      let sales = getSalesHistory();
      sales = filterSalesByPeriod(sales, period);

      if(paymentFilter !== 'all'){
        sales = sales.filter(s => s.paymentMethod === paymentFilter);
      }

      const csvContent = "data:text/csv;charset=utf-8,"
        + "Date,Time,Cashier,Order Type,Payment,Total,Status\n"
        + sales.map(sale => {
            const date = new Date(sale.timestamp);
            const status = sale.refunded ? 'Refunded' : 'Completed';
            return `${date.toLocaleDateString()},${date.toLocaleTimeString()},${sale.cashier},${sale.orderType},${sale.paymentMethod},${sale.total},${status}`;
          }).join("\n");

      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", `sales_report_${period}_${new Date().toISOString().split('T')[0]}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    };

    // Initialize
    renderCategories();
    renderProducts();
    renderCart();
    updateTotal();
    updateCheckoutButton();
  </script>
</body>
</html>
